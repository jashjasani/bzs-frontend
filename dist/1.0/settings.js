document.addEventListener("DOMContentLoaded",async e=>{let s={email:document.getElementById("Dein-Benutzername"),first_name:document.getElementById("Dein-Vorname"),last_name:document.getElementById("nachname"),phone:document.getElementById("Telefon"),address:{street:document.getElementById("Stra-e"),house_no:document.getElementById("Hausnummer"),zip:document.getElementById("PLZ"),city:document.getElementById("Stadt"),country:document.getElementById("Land-auswahlen"),company:document.getElementById("Firma")}};var t=await fetch("https://bildzeitschrift.netlify.app/.netlify/functions/user",{method:"GET",headers:{Authorization:sessionStorage.getItem("auth")},cache:"no-cache"});200==t.status&&(t=await t.json(),s.email.value=t.email,s.first_name.value=t.first_name,s.last_name.value=t.last_name,s.phone.value=t.phone||"","address"in t)&&(s.address.city.value=t.address.city||"",s.address.street.value=t.address.street||"",s.address.zip.value=t.address.zip||"",s.address.house_no.value=t.address.house_no||"",s.address.company.value=t.address.company||"",s.address.country.value=t.address.country||""),document.getElementById("billing-form").addEventListener("submit",async function(e){e.preventDefault(),e.stopPropagation();e={first_name:s.first_name.value,last_name:s.last_name.value,phone:s.phone.value,address:{street:s.address.street.value,house_no:s.address.house_no.value,zip:s.address.zip.value,city:s.address.city.value,company:s.address.company.value,country:s.address.country.value}};var t;await(async(e,t)=>{try{return 200!==(await fetch(`https://zip-api.eu/api/v1/radius/${t}-`+e)).status}catch(e){console.warn(e.message)}})(s.address.zip.value,s.address.country.value)?Swal.fire({position:"center",icon:"error",title:"Zip code invalid for given country.",showConfirmButton:!1,timer:1500}):""==s.address.country.value?Swal.fire({position:"center",icon:"error",title:"Country must be selected.",showConfirmButton:!1,timer:1500}):200==(e=await fetch("https://bildzeitschrift.netlify.app/.netlify/functions/user",{method:"PUT",headers:{Authorization:sessionStorage.getItem("auth"),"Content-Type":"application/json"},body:JSON.stringify(e)})).status?(Swal.fire({position:"center",icon:"success",title:"Invoice details have been saved.",showConfirmButton:!1,timer:1500}),t={email:s.email.value,shipToBillingAddress:!0,billingAddress:{name:s.first_name.value+" "+s.last_name.value,address1:s.address.street.value+" "+s.address.house_no.value,city:s.address.city.value,country:s.address.country.value,province:"",postalCode:String(s.address.zip.value),phone:String(s.phone.value),firstName:s.first_name.value}},await Snipcart.api.cart.update(t)):403==e.status&&alert("Invalid credentials")},!0),document.getElementById("password-form").addEventListener("submit",async function(e){e.preventDefault(),e.stopPropagation();e={old_password:document.getElementById("Altes-Passwort").value,new_password:document.getElementById("Neues-Passwort").value};if(e.new_password!=document.getElementById("Neues-Passwort-2").value)Swal.fire({position:"center",icon:"error",title:"Passwort und Bestätigungspasswort stimmen nicht überein",showConfirmButton:!1,timer:1500});else try{var t=await fetch("https://bildzeitschrift.netlify.app/.netlify/functions/user",{method:"PUT",headers:{Authorization:sessionStorage.getItem("auth")},cache:"no-cache",body:JSON.stringify(e)});200==t.status?Swal.fire({position:"center",icon:"success",title:"Passwort wurde erfolgreich zurückgesetzt",showConfirmButton:!1,timer:1500}):403==t.status?Swal.fire({position:"center",icon:"error",title:"Incorrect old password",showConfirmButton:!1,timer:1500}):401==t.status&&alert("Please verify your mail."),document.getElementById("password-form").reset()}catch(e){console.log(e.message)}},!0)});